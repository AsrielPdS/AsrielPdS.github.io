import{g as h,w as c,C as F,f as Z,h as x,u as S,o as xe,j as m,k as ke,$ as q,d as k,t as be,i as B,m as b,n as P,p as oe,q as _e,r as $,v as A,x as V,y as he,z as M,A as N,B as fe,D as qe,E as pe,F as me,G as De,H as se,I as W,J,K as z,L as U,M as Ae,N as L,O as He,P as Me,Q as T,R as X,S as ze,T as Le,U as Te,V as Ve,W as Ne,X as Ce,Y as j,Z as Oe,_ as Ee,a0 as Se,a1 as re,a2 as Be,a3 as E,a4 as le,a5 as ne,a6 as Ie,a7 as v,a8 as Fe,a9 as ae,s as Pe,a as $e}from"./shared-6320bd96.js";const _=(i,e,t)=>({tp:i,params:t,render:()=>e}),G=()=>_("req",c.required);function ce(i,e){if(e)for(let t of e){let l=function(){this&&(s[this.name]=this.value),r(s,i)},s={},r=t.at(-1);for(let n=0;n<t.length-1;n++){let u=t[n],o=i.input(u);s[u]=o.value,o.onset(["value","off"],l)}setTimeout(l)}}class Re extends F{inputs;constructor(e,t){V(e)&&(t=e,e={}),super(e),this.inputs=P(t),ce(this,e.bots)}view(){throw 1}get isDef(){for(let e of this.inputs)if(!e.isDef())return!1;return!0}input(e){for(let t of this.inputs)if(t.name==e||oe(t,Y)&&(t=t.input(e)))return t}errors={};setErrors(e,t){this.errors[e]=t,this.input(e)?.error(!!t)}valid(e,t=!e){if(e)return!this.inputs.some(s=>s.invalid(s.value,!0));for(let s of this.inputs){let r=s.invalid(s.value,e,t);this.setErrors(s.name,r),r&&t&&(s.focus(),t=!1)}return!_e(this.errors,s=>s&&m(s))}focus(){for(let e of this.inputs)if(!e.p.off){e.focus();break}return this}fill(e,t){return this.emit("fill",e).inputs.forEach(s=>s.fill(e,t)),this}reset(...e){for(let t of m(e)?this.inputs.filter(s=>e.includes(s.name)):this.inputs)t.visited=!1,t.value=t.def;return this}data(e,t){let s=this.inputs,r=$({},this.p.hidden);for(let l of e?s.filter(n=>t&&n.p.req||!n.isDef()):s)l.p.off||l.submit(r,e,t);return this.emit("submit",r),r}formData(e,t){let s=new FormData,r=this.data(e,t);for(let l in r)s.append(l,r[l]);return s}}function Ke(i,e){let t=[];for(let s in e){let r=A(i,s,"name");t.push(e[s]?.map(l=>k([r&&[h("b",0,r.p.text),": "],l])))}return t}class Q extends Re{errDiv;constructor(e,t){super(e,t),this.errDiv=this.p.errorDiv||ke(),this.p.outline==null&&(this.p.outline=q.oform),this.inputs.forEach(this.addInput,this)}addInput(e){e.form=this,e.onset(["value","off"],()=>{e.visited&&this.setErrors(e.name,e.invalid(e.value));let t=e.field(this).attr("edited",!e.isDef());this.p.offFN?.(t,!!e.p.off),this.emit("input",e)}),e.observeVisited(t=>this.setErrors(t.name,t.invalid(t.value)))}view(){let{p:e,inputs:t}=this;return h(e.tag||"form","_ form",[t.map(s=>s.field(this)),this.errDiv])}setErrors(e,t){super.setErrors(e,t),this.errDiv.set(Ke(this.inputs,this.errors))}}function Ze(i,e,t,s=qe(),r,l){return V(e)&&(e=new Q(e)),new Promise(n=>{he(i,h(e.set("tag","div"),"bd"),(u,o)=>[s.p({type:"submit"}).on("click",f=>{f.preventDefault(),e.valid()&&(M(f),N(o,async()=>{let g=e.data();n(await t?.(g,e)||g),u()}))}),r||fe(()=>{u(),n(null)})],l,!r),e.focus()})}function Je(i,e,t,s=t?.p?.labelSz){let r=x(t?.p.outline,e.outline),l=k("_ "+(r?"oi":"ii"),[(!r||e.text)&&h("label","hd",[e.text,e.tip&&be(B(b.info),e.tip)]).css("width",`${s}%`).attr({for:e.name}),i=h(i,"bd").css("width",`${100-s}%`),!!e.req&&h("span","req","*")]);return e.off&&t?.p.offFN?.(i,!0),l}class R extends F{constructor(e){super(e),Z(e.text)&&(e.text=x(c[e.name],S(e.name))),Z(e.value)&&(e.value=this.def)}get name(){return this.p.name}get value(){return x(this.p.value,null)}set value(e){this.set("value",e)}fill(e,t){let s=this.p.name;s in e&&(this.value=e[s],t&&this.set("def",e[s]))}get def(){return x(this.p.def,this.null)}isDef(e=this.value,t=this.def){return t===e}isNull(e=this.value){return this.isDef(e,this.null)}visited;observeVisited(e){xe(h(this),()=>{this.visited=!0,e(this)})}error(e){return h(this).c("_e",e),this}invalid(e,t,s){if(this.p.off)return null;let r=this.validate(e,t,s);return m(r)?r:null}validate(e){return this.p.req&&this.isNull(e)?[G()]:[]}#e;field(e,t){return this.#e||=Je(this,this.p,e,t)}submit(e){let{name:t,value:s,submit:r}=this.p;r?r(e):e[t]=s}get null(){return null}}class Ue extends R{view(){var e=this.p,t;return e.input=="ta"?t=h("textarea","_ in v").p({name:e.name,id:e.name,placeholder:e.ph||""}).on("keydown",s=>{s.key=="Enter"&&(s.ctrlKey?s.preventDefault():s.stopPropagation())}):t=h("input","_ in").p({type:e.input||"text",name:e.name,id:e.name,placeholder:e.ph||""}),t.on({input:()=>{this.emit("input",t.v()),this.set("value",t.v()||null)},focus(){t.e.select()}}),this.bind(t,()=>t.e.value=e.value||"","value")}validate(e){let t=this.p,s=[];return e?(t.pattern&&!t.pattern.test(e)&&s.push(_("invalid_format",c.invalidFmt)),t.max&&e.length>t.max&&s.push(_("text_too_long","",{max:t.max})),t.min&&e.length<t.min&&s.push(_("text_too_short","",{min:t.min}))):t.req&&s.push(G()),s}}class je extends R{view(){let e=this.p,t=h("input",{type:"number",placeholder:e.ph||"",step:e.integer?1:"any",name:e.name,id:e.name,value:e.value,min:e.min??e.omin,max:e.max??e.omax,oninput:()=>this.value=t.v()?t.e.valueAsNumber:null,onfocus(){t.e.select()}});return this.onset(["value","off"],()=>{t.v(e.value),t.e.disabled=!!e.off}),(e.unit?h("span",0,[t,e.unit]):t).c("_ in")}validate(e){return We(this.p,e)}focus(){let{$:e,p:t}=this;return(t.unit?e.first:e).focus(),this}}function We(i,e){let t=[];if(e==null)i.req&&t.push(G());else{i.integer&&Math.floor(e)!=e&&t.push(_("is_decimal"));let{min:s,max:r,omin:l,omax:n}=i;r!=null&&e>r?t.push(_("number_too_big","",{max:r})):n!=null&&e>=n&&t.push(_("number_too_big","",{max:n})),s!=null&&e<s?t.push(_("number_too_small","",{min:s})):l!=null&&e<=l&&t.push(_("number_too_small","",{min:l}))}return t}class Xe extends R{options;get active(){return A(this.options,this.p.value,this.options.key)}constructor(e,t,s=0){super(e),e.item||=r=>x(r[1],r[s]),this.options=pe(t,{key:s,parse:r=>me(r)?r:{[s]:r}})}get value(){return this.p.value}set value(e){this.p.value===e||this.set("value",e)}view(){let{p:e,options:t}=this,s=h("span"),r=h("table").on("click",({currentTarget:u,target:o})=>u!=o&&(this.set("open",!1).value=h(o).closest("tr").d())),l=k("_ menu",r),n=De(this,t,s,l,u=>this.value=u).attr({name:e.name});return se(this,s),this.on(u=>"value"in u&&se(this,s)),t.bind(r,{insert:u=>W(u.i,e.item(u)).d(u[t.key]),tag(u,o,f,g){let w=f.child(o);w.c(g,u),u&&l.e.scroll({top:w.p("offsetTop")-l.p("clientHeight")/2+w.p("clientHeight")/2})}}),n}option(e){return this.options.find(e)}}class Y extends R{#e;get form(){return this.#e}set form(e){this.#e=e;for(let t of this.inputs)t.form=e}constructor(e,t){e.value=null,super(e);for(let s of this.inputs=P(t))s.onset(["value","off"],()=>{let r=h(s).attr("edited",!s.isDef());this.form.p.offFN?.(r,!!s.p.off),this.set(["value"])});ce(this,e.bots)}inputs;get def(){return J(this.inputs,e=>[e.name,e.def])}get value(){return J(this.inputs,e=>[e.name,e.value])}set value(e){this.inputs.forEach(t=>t.name in e&&(t.value=e?e[t.name]:t.null))}view(){for(let e of this.inputs)e.onset("value",()=>this.set(["value"]));return h("span","_ join",this.inputs)}fill(e,t){if(!(this.p.sub&&!(e=e[this.p.name])))for(let s of this.inputs)s.fill(e,t)}validate(e,t,s){let r=[];for(let l of this.inputs){let n=l.invalid(l.value,t,s);n&&r.push(...n),n&&s&&(l.focus(),s=!1)}return r}focus(){return this.inputs[0]?.focus(),this}submit(e,t,s){let{inputs:r,p:l}=this;l.sub&&(e=e[l.name]=l.sub=="array"?[]:{});for(let n of t&&!l.sub?r.filter(u=>s&&u.p.req||!u.isDef()):r)n.p.off||n.submit(e,t,s)}input(e){for(let t of this.inputs)if(t.name==e||oe(t,Y)&&(t=t.input(e)))return t}isDef(e=this.value,t=this.def){for(let s of this.inputs)if(!s.isDef(e[s.name],t[s.name]))return!1;return!0}}class Ge extends F{view(){let e=this.p,t,s=h("span"),r;if(e.setlimit)var l=new Xe({value:e.limit,fluid:!0,clear:!1},[e.min,e.min*5,e.min*10,e.min*10,e.min*20,[0,c.showAll]]);return this.bind(k("_ bar pag",[e.extreme&&T(b.first,null,()=>this.set("pag",1)),T(b.prev,null,()=>this.set("pag",e.pag-1)),re().css({textAlign:"center"}),T(b.next,null,()=>this.set("pag",e.pag+1)),e.extreme&&T(b.last,s,()=>this.set("pag",t)),l&&[h("hr"),l.onset("value",({value:n})=>{this.set("limit",n)})],h("hr"),r=re()]),n=>{r.set(`${Math.min(e.total-e.limit*(e.pag-1),e.limit||e.total)||0} / ${e.total||0}`),t=e.limit?Math.ceil((e.total||0)/e.limit):1,n.c("off",!!(t<2&&e.hideOnSingle));let u=e.extreme?0:1;n.child(2-u).set(e.pag),n.childs(0,2-u).p("disabled",e.pag==1),n.childs(3-u,5-u*2).p("disabled",e.pag==t),s.set(t)})}get pags(){let{limit:e,total:t}=this.p;return e?Math.ceil((t||0)/e):1}}function Qe(i,e,t=e){let s=new Ge({pag:i.pag,min:i.limit,limit:i.limit,extreme:t,setlimit:e}).on(r=>{"pag"in r&&(i.pag=r.pag,"limit"in r||i.update()),"limit"in r&&(i.limit=r.limit)});return i.on(([r])=>s.set({total:r,limit:i.limit,pag:i.pag})),s}class Ye extends F{get cols(){return this.p.cols}data;form;constructor(e,t){super(e),this.data=pe(t,{g:e.single?null:["on"],key:e.key,clear:!0}),e.head||=s=>x(x(s.text,c[s.key]),S(s.key))}ccss(e,t,s=1){let r=0;if(Be(t)){let l=this.cols,n=t,u=0;for(t=l[t];u<s;u++)r+=l[n+u].size}else r=t.size;return e.c("i").css({width:r+"px",textAlign:t.align})}view(){let e=this.p,t=e.cols,s=e.allColumns,r=e.reqColumns,l=this.data,n,u=s&&X(null,s.map(a=>j(t.includes(a),x(x(a.text,c[a.key]),S(a.key)),p=>{p?(t.push(a),t.sort((d,y)=>s.indexOf(d)-s.indexOf(y))):t.remove(a)},a.key,r&&r.includes(a.key)))).on("click",a=>M(a)),o=t.bind(k("hd _ tr",E(e.corner,"sd")),{insert:(a,p,d)=>{let y=this.ccss(E(e.head(a),"i"),a).uncss("textAlign");e.resize&&k("div").addTo(y).on("mousedown",O=>{M(O);let D=t.indexOf(a)+1;if(!e.fill||D<m(t)){let te=function(ie){if(a.size=a.size=Math.max(q.rem*2,ie.clientX-y.rect.left),ee.css({width:a.size+"px"}),K){let we=t[D].size=Math.max(q.rem*2,ye-ie.clientX);K.css({width:we+"px"})}},ee=w.childs().child(D),K=e.fill&&ee.next(),ve=K?.e?.(0),ye=ve?.rect?.right;le.css({cursor:"col-resize",userSelect:"none"}),ne.on("mousemove",te).one("mouseup",()=>{ne.off("mousemove",te),le.uncss("cursor","userSelect")})}}),e.sort&&y.on("click",()=>{t.tag("sort")==a?a.desc?(a.desc=!1,t.tag("sort",null)):(a.desc=!0,t.retag("sort")):(a.desc=!1,t.tag("sort",a))}),u&&y.on({mouseenter(){clearTimeout(n),y.add(u)},mouseleave(){n=setTimeout(()=>u.remove().child(".menu")?.remove(),300)}}),d.place(p+1,y)},tag(a,p,d,y,O){let D=d.child(p+1);switch(y){case"sort":D.child(".sort")?.remove(),a&&D.add(B(b[O.desc?"desc":"asc"]).c("sort")),e.sort.call(O,a);break;default:D.c(y,a)}},remove(a,p,d){d.unplace(p+1)},clear(a){a.childs(1).remove()}}),f=a=>h(a(this),"_ ft tr"),g=e.foot&&Ie(...e.foot.map(f)),w=k("_ tb",[o,g]).on("click",a=>a.target==a.currentTarget&&v.clear(l,"on")).p("tabIndex",0).on("keydown",a=>{it(l,a,e)&&M(a)}),C=a=>[k("sd"),t.map(p=>this.ccss(E(p.fmt?p.fmt(a[p.key],e.p,a):a[p.key]),p))];return l.bind(w,{insert:(a,p)=>{let d=k("_ tr i",C(a));w.place(p+1,tt(e.style?.(d,a,p)||d,a,l,e))},reload(a,p){w.child(p+1).set(C(a))},tag:(a,p,d)=>{let y=d.child(p+1).c("crt",a).e;a&&y.scrollIntoView({block:"nearest",inline:"nearest"})},remove(a,p,d){d.unplace(p+1)},clear(a){a.childs().slice(1).remove()},groups(a,p,d,y){d.child(p+1).c(y,a)}}),t.on(()=>{this.data.reloadAll(),g?.eachS((a,p)=>a.replace(f(e.foot[p])))}),e.resize&&w.c("brd"),w}fillArea(e=2*q.rem){let t=this.p.cols,s=h(this),r=s.childs();console.log(e,s.e.clientWidth),et(t,s.e.clientWidth-2-e);for(let l=0;l<m(t);l++)r.child(l+1).css({width:t[l].size+"px"})}}function et(i,e=100){let t=0,s=i.length,r=[];for(let l of i){let n=l.size||1/s;r.push(n),t+=n}for(let l=0;l<s;l++)i[l].size=r[l]/t*e}function tt(i,e,t,s){let r=l=>v.add(t,"on",e,v.tp(l.ctrlKey,l.shiftKey));return i.on({click:r,dblclick:s.open&&(()=>s.open(...v.list(t,"on"))),contextmenu:s.menu&&(l=>{r(l);let n=s.menu(v.list(t,"on"));n&&Fe(l,n)})})}const H=(i,e,{ctrlKey:t,shiftKey:s})=>s?v.move(i,"on",e,v.tp(t,!1)):t?v.movePivot(i,"on",e):v.move(i,"on",e,0);function it(i,e,t,s){switch(e.key){case"Delete":let r=v.list(i,"on");if(r.length&&t.remove)(async()=>{if(await t.remove(r)!==!1)for(let l of r)i.remove(l)})();else return;break;case"Home":H(i,-v.pivot(i,"on"),e);break;case"End":H(i,i.length-v.pivot(i,"on"),e);break;case"PageDown":H(i,10,e);break;case"PageUp":H(i,-10,e);break;case"Enter":if(t.open){t.open(...v.list(i,"on"));break}else return;case"ArrowUp":if(s)return;H(i,-1,e);break;case"ArrowDown":if(s)return;H(i,1,e);break;default:return}return!0}class st{#e;#t;#i;list;readOnly;length;task;fromStorage;toStorage;src;all;groupBy;sort;queryBy;fields;w;constructor(e,t={}){V(t)&&(t={fields:t}),this.src=e,this.#i=x(t.limit,q.defLimit),this.#t=t.pag||1;let s=()=>{this.#t=1,this.update(!0)};this.query=t.query,this.sort=L(t.sort,{parse:r=>Le(r)?[r]:r,key:0}).on(s),this.fields=L(t.fields||P(e.fields.map(r=>z(r.get)&&r.name)),r=>{if(!A(e.fields,r,"name"))throw Te(r,"field",e);return r}).on(()=>this.update(!0)),this.queryBy=L(t.queryBy||e.fields.filter(r=>r.query).map(r=>r.name)).on(s),this.w=V(t.where)?J(t.where,(r,l)=>[l,r]):t.where}get pags(){return this.#i?Math.ceil(this.length/this.#i):1}get query(){return this.#e}set query(e){e!=this.#e&&(this.#t=1,this.#e=e,this.update(!0))}get pag(){return this.#t}set pag(e){e<1?e=1:e>this.pags&&(e=this.pags),this.#t!=e&&(this.#t=e,this.update())}get limit(){return this.#i}set limit(e){this.#i!=e&&(this.#t=e?Math.ceil(this.#i*this.#t/e):1,this.#i=e,this.update())}ids(){let e=this.src;if(this.pags>1){let t=this.toJSON();return e.get({tp:"col",fields:[e.id],where:t.where,query:t.query,queryBy:t.queryBy})}else return this.list.map(t=>e.id||t.id)}where(e,t){return(this.w||={})[e]!==t&&(t?this.w[e]=t:delete this.w[e],this.update(!0)),this}bind(e){if(!this.list){let t=this.src;(this.list=V(e)?e:L(e)).key=t.id,(t.bonds||=[]).push(new WeakRef(this)),this.update()}return this.list}getAll(e="rows"){return this.src.get($(this.toJSON(),{tp:e,limit:void 0,pag:void 0}))}#s;#r;update(e){let t=async()=>{let s={},r={},l=this.list,n=this.#l;if(l||n){let u=this.src,o=await(this.task=u.get(this.toJSON(),(this.#s=new AbortController).signal));if(this.task=this.#s=null,this.length=o[0],l){for(let f in l.tags)l.tags[f]&&(s[f]=l.tags[f].v[u.id]);for(let f in l.g)r[f]=l.g[f].keyField();l.set(o[1]);for(let f in s)l.tag(f,s[f]);for(let f in r){let g=r[f];l.g[f].set(l.filter(w=>g.indexOf(w[u.id||"id"])!=-1))}}if(n)for(let f of n)f(o);return o}};return this.#s?.abort(),clearTimeout(this.#r),this.task=null,e?(this.#r=setTimeout(t),this):t()}#l;on(e){return(this.#l||=[]).push(e),this}toJSON(){let{query:e,queryBy:t,fields:s,w:r,sort:l,src:n,limit:u,pag:o}=this;return{tp:"full",fields:!m(s)||m(n.fields)==m(s)?void 0:s.map(f=>{let g=A(n.fields,f,"name").exp;return g?[f,g]:f}),where:r&&Object.values(r),limit:u,pag:o==1?void 0:o,query:e||void 0,queryBy:e&&m(t)?t:void 0,sort:l.length?l:void 0}}}const rt=i=>h("label","_ in",[Ve(h("input",{type:"search",name:`${i.src}_search`,value:i.query||"",placeholder:c.search+"..."}),"input",500,function(){i.query=this.value}),Ne(b.search,null,()=>i.update())]);function lt({queryBy:i,src:e}){let t=e.fields.filter(r=>r.query);if(!t.length)return null;let s=Ce([j(m(t)==m(i)?!0:m(i)?null:!1,c.all,r=>i.set(r&&t.map(l=>l.name)),"all"),Oe(),...t.map(r=>j(i.includes(r.name),x(r.text,S(r.name)),l=>l?i.push(r.name):i.remove(r.name),r.name))]);return i.on(()=>{s.query("#all").p({checked:m(t)==m(i),indeterminate:m(i)&&m(t)!=m(i)});for(let r of s.queryAll("input:not(#all)"))r.checked=i.includes(r.id)}),X(null,()=>s)}function nt(i,e){let t=i.bind(),s=h("input",{type:"checkbox"}).on("input",()=>{s.p("checked")?(v.addAll(t,"on"),s.p({checked:!0,indeterminate:!1}),i.all=void 0,N(h(e),async()=>{let r=await i.getAll();Z(i.all)&&(i.all=r)},null,250)):v.clear(t,"on")});return v.onchange(t,"on",(r,l)=>{i.all=null,s.p({checked:!!r,indeterminate:!!r&&(i.pags>1||(l?l.length<t.length:t.length>1))})}),s}const at={null:()=>k(0,B(b.null)),invalidIcon:()=>B("image-broken"),checkboxFmt:"icon",wrap:E,html:!0,interactive:!0,format:!0};function ut(i,e={}){let t=i.src,s=t.fields.filter(o=>z(o.get)),r=s.map(o=>({dt:o.dt,key:o.name,text:o.text,size:(o.size||10)*q.rem,align:o.align,fmt:o.out?.bind(o)}));m(i.fields)||i.fields.set(U(s,"name"));let l=L(i.fields.map(o=>A(r,o,"key")));Ee(l,i.fields,!1,o=>o.key);let n=h("span"),u=new Ye({cols:l,fill:e.fill,resize:!0,single:e.single,style:e.style||t.style,p:e.p||at,corner:n,menu:e.menu&&(o=>e.menu(i.all||o,i,u)),open:o=>de(t,o?.id),remove:o=>ge(t,U(o,t.id||"id")),allColumns:r,reqColumns:e.req||[t.main],key:t.id||"id",sort:{clear:!0,call({key:o,desc:f},g){i.sort.set(g&&[[o,f]])}}},i.bind());return n.add(nt(i,h(u))),u}async function ot(i,e){return i.mdform?i.mdform():(e||=i.form?await i.form(i):new Q(i.fields.map(t=>t.set&&t.in())),Ze([0,I(c.newItemTitle,{src:i.s})],e,t=>i.post([t])))}async function de(i,e,t){let s=await i.get({tp:"row",where:[`${i.id}='${e}'`],src:!0});if(i.mdform)return i.mdform(s);he([0,I(c.editItemTitle,{src:i.s,item:h("strong",0,s[i.main])})],(t||=i.form?await i.form(i,!0):new Q(i.fields.map(r=>x(r.edit,r.set)&&r.in()))).set("tag","div").fill(s,!0),(r,l)=>[ae(c.save,async n=>{M(n),t.valid()&&await N(l,()=>i.put([$(t.data(!0),{id:e})])),r()},"submit"),i.post&&ae(c.duplicate,async n=>{M(n),t.valid()&&await N(l,()=>i.post([t.data()])),r()},"submit"),fe(r)]),t.focus()}function I(i,e){if(i){let t=[],s=/{(\w+)}/g,r,l=0;for(;r=s.exec(i);)t.push(i.slice(l,l=r.index),e[r[1]]),l+=m(r[0]);return t.push(i.slice(l,m(i))),P(t)}}async function ge(i,e){let t=m(e),s=e[0]?.[i.main];await Se(t==1&&s?I(c.confirmRemove,{src:i.s,item:h("strong",0,s)}):I(c.confirmRemoveMany,{src:t==1?i.s:i.p,count:t}))&&await i.del(e.map(r=>me(r)?r[i.id]:r))}function ht(i,e){return W(b.remove,c.remove,()=>ge(i,e),q.sc.remove,!m(e)||!i.del)}function ft(i,e){return W(b.edit,c.edit,()=>de(i,e[0][i.id]),q.sc.edit,m(e)!=1||!i.put)}function pt(i,{src:e}){return[ft(e,i),ht(e,i)]}async function mt(i,e={}){let t=i.src,s=ut(i,{menu:He(e.menu)?e.menu:pt,single:e.single});return[k("_ bar",[rt(i),lt(i),Me(),await e.options?.(i,s),z(e.add)&&t.post&&T(b.plus,`${c.add} ${t.s||""}`,()=>ot(t)).id("add"),e.more&&X(null,e.more,"vs")]),h(s).css("flex",1),h(Qe(i,!0),0,[h("hr","r"),e.totals&&(()=>{let r=k("_ bar",e.totals);return i.on(()=>r.set(e.totals)),r})()])]}const ct=new Intl.NumberFormat,dt=i=>i==null?"":ct.format(i),ue=(i,{req:e,def:t,text:s,query:r,input:l,set:n})=>({name:i,set:z(n),text:s,in:()=>new Ue({name:i,input:l,req:e,def:t,text:s}),query:z(r)}),gt=(i,{req:e,def:t,text:s,set:r})=>({name:i,text:s,set:z(r),in:()=>new je({name:i,req:e,def:t,text:s}),out:(l,n)=>l==null?n.null:dt(l)});function vt(i,e,t="id",s=t=="id"){let r=1;return{fields:e,get(l){return new Promise(()=>{let n=i;if(l.sort){n=n.slice();for(let o of l.sort){let[f,g]=ze(o),w=g?1:-1;n.sort((C,a)=>{let p=C[f],d=a[f];return p==d?0:(p>d?1:-1)*w})}}l.where?.length&&(n=i.filter(o=>!0));let u=m(n);switch(l.limit&&(n=n.slice((l.pag-1)*l.limit,l.pag*l.limit)),l.tp||"rows"){case"full":return[u,n];case"rows":return n;case"col":return U(n,l.fields[0]);case"row":return n[0];case"one":return x(n[0]?.[l.fields[0]],null);default:throw"not supported"}})},post(l){let n=Array(m(l));for(let u of l){if(u[t]==null)if(s)u[t]=r++;else throw"invalid";if(A(i,u[t],t))throw"invalid";n.push({[t]:u[t]}),i.push(u)}return n},put(l){for(let n of l){let u=A(i,n.id,t);if(u)for(let o in n)u[o]=n[o]}},del(l){for(let n of l){let u=Ae(i,n,t);u!=-1&&i.splice(u,1)}}}}$(b,{plus:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",prev:"M14,7L9,12L14,17V7Z",next:"M10,17L15,12L10,7V17Z",first:"M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z",last:"M16,18H18V6H16M6,18L14.5,12L6,6V18Z",dd:"M7,10L12,15L17,10H7Z",search:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"});Pe({pt:{hi:"Ola, meu nome é",name:"Nome",popu:"Habitantes",add:"Adicionar"},en:{hi:"Hi, my name is",name:"Name",popu:"Population",add:"Add",search:"Search",cancel:"Cancel",confirm:"Confirm",required:"Required",crudTitle:"Simple crud with suport to add, edit and remove."}});const yt=vt([],[ue("name",{req:!0,text:c.name}),ue("capital",{}),gt("population",{text:c.popu})]);$e("cruded",[h("h2",[c.crudTitle]),N(()=>mt(new st(yt,{limit:20})))]);
