import{g as d,w as c,i as Me,l as m,a as S,C as j,b as B,d as x,u as Z,o as qe,e as Ae,$ as q,c as L,t as Ce,f as b,h as R,j as de,k as Fe,m as D,n as M,p as K,q as he,r as T,s as E,v as me,x as Te,y as ce,z as pe,A as De,B as le,D as Q,E as ne,F as C,G as U,H as ge,I as z,J as _e,K as He,L as I,M as Y,N as Ie,O as Se,P as Be,Q as Ee,R as X,S as Re,T as Ve,U as ze,V as Oe,W as O,X as ae,Y as oe,Z as Ne,_ as w,a0 as Pe,a1 as ue,a2 as Ze,a3 as Ke,a4 as Ue,a5 as $e,a6 as fe,a7 as je,a8 as N}from"./shared-09b9a1d4.js";const P=(s,e,t)=>({tp:s,params:t,render:()=>e}),ve=()=>P("req",c.required);function ye(s,e){if(e)for(let t of e){let l=function(){this&&(i[this.name]=this.value),r(i,s)},i={},r=t.at(-1);for(let u=0;u<t.length-1;u++){let n=t[u],o=s.input(n);i[n]=o.value,o.onset(["value","off"],l)}setTimeout(l)}}class Je extends j{inputs;constructor(e,t){K(e)&&(t=e,e={}),super(e),this.inputs=R(t),ye(this,e.bots)}view(){throw 1}get isDef(){for(let e of this.inputs)if(!e.isDef())return!1;return!0}input(e){for(let t of this.inputs)if(t.name==e||de(t,te)&&(t=t.input(e)))return t}errors={};setErrors(e,t){this.errors[e]=t,this.input(e)?.error(!!t)}valid(e,t=!e){if(e)return!this.inputs.some(i=>i.invalid(i.value,!0));for(let i of this.inputs){let r=i.invalid(i.value,e,t);this.setErrors(i.name,r),r&&t&&(i.focus(),t=!1)}return!Fe(this.errors,i=>i&&m(i))}focus(){for(let e of this.inputs)if(!e.p.off){e.focus();break}return this}fill(e,t){return this.emit("fill",e).inputs.forEach(i=>i.fill(e,t)),this}reset(...e){for(let t of m(e)?this.inputs.filter(i=>e.includes(i.name)):this.inputs)t.visited=!1,t.value=t.def;return this}data(e,t){let i=this.inputs,r=D({},this.p.hidden);for(let l of e?i.filter(u=>t&&u.p.req||!u.isDef()):i)l.p.off||l.submit(r,e,t);return this.emit("submit",r),r}formData(e,t){let i=new FormData,r=this.data(e,t);for(let l in r)i.append(l,r[l]);return i}}function We(s,e){let t=[];for(let i in e){let r=M(s,i,"name");t.push(e[i]?.map(l=>L([r&&[d("b",0,r.p.text),": "],l])))}return t}class ee extends Je{errDiv;constructor(e,t){super(e,t),this.errDiv=this.p.errorDiv||Ae(),this.p.outline==null&&(this.p.outline=q.oform),this.inputs.forEach(this.addInput,this)}addInput(e){e.form=this,e.onset(["value","off"],()=>{e.visited&&this.setErrors(e.name,e.invalid(e.value));let t=e.field(this).attr("edited",!e.isDef());this.p.offFN?.(t,!!e.p.off),this.emit("input",e)}),e.observeVisited(t=>this.setErrors(t.name,t.invalid(t.value)))}view(){let{p:e,inputs:t}=this;return d(e.tag||"form","_ form",[t.map(i=>i.field(this)),this.errDiv])}setErrors(e,t){super.setErrors(e,t),this.errDiv.set(We(this.inputs,this.errors))}}function Ge(s,e,t,i=Te(),r,l){return K(e)&&(e=new ee(e)),new Promise(u=>{he(s,d(e.set("tag","div"),"bd"),(n,o)=>[i.p({type:"submit"}).on("click",f=>{f.preventDefault(),e.valid()&&(T(f),E(o,async()=>{let y=e.data();u(await t?.(y,e)||y),n()}))}),r||me(()=>{n(),u(null)})],l,!r),e.focus()})}function Xe(s,e,t,i=t?.p?.labelSz){let r=x(t?.p.outline,e.outline),l=L("_ "+(r?"oi":"ii"),[(!r||e.text)&&d("label","hd",[e.text,e.tip&&Ce(S(b.info),e.tip)]).css("width",`${i}%`).attr({for:e.name}),s=d(s,"bd").css("width",`${100-i}%`),!!e.req&&d("span","req","*")]);return e.off&&t?.p.offFN?.(s,!0),l}class J extends j{constructor(e){super(e),B(e.text)&&(e.text=x(c[e.name],Z(e.name))),B(e.value)&&(e.value=this.def)}get name(){return this.p.name}get value(){return x(this.p.value,null)}set value(e){this.set("value",e)}fill(e,t){let i=this.p.name;i in e&&(this.value=e[i],t&&this.set("def",e[i]))}get def(){return x(this.p.def,this.null)}isDef(e=this.value,t=this.def){return t===e}isNull(e=this.value){return this.isDef(e,this.null)}visited;observeVisited(e){qe(d(this),()=>{this.visited=!0,e(this)})}error(e){return d(this).c("error",e),this}invalid(e,t,i){if(this.p.off)return null;let r=this.validate(e,t,i);return m(r)?r:null}validate(e){return this.p.req&&this.isNull(e)?[ve()]:[]}#e;field(e,t){return this.#e||=Xe(this,this.p,e,t)}submit(e){let{name:t,value:i,submit:r}=this.p;r?r(e):e[t]=i}get null(){return null}}class Qe extends J{view(){var e=this.p,t;return e.input=="ta"?t=d("textarea","_ in v").p({name:e.name,id:e.name,placeholder:e.ph||""}).on("keydown",i=>{i.key=="Enter"&&(i.ctrlKey?i.preventDefault():i.stopPropagation())}):t=d("input","_ in").p({type:e.input||"text",name:e.name,id:e.name,placeholder:e.ph||""}),t.on({input:()=>{this.emit("input",t.v()),this.set("value",t.v()||null)},focus(){t.e.select()}}),this.bind(t,()=>t.e.value=e.value||"","value")}validate(e){let t=this.p,i=[];return e?(t.pattern&&!t.pattern.test(e)&&i.push(P("invalid_format",c.invalidFmt)),t.max&&e.length>t.max&&i.push(P("text_too_long","",{max:t.max})),t.min&&e.length<t.min&&i.push(P("text_too_short","",{min:t.min}))):t.req&&i.push(ve()),i}}class Ye extends J{options;get active(){return M(this.options,this.p.value,this.options.key)}constructor(e,t,i=0){super(e),e.item||=r=>x(r[1],r[i]),this.options=ce(t,{key:i,parse:r=>pe(r)?r:{[i]:r}})}get value(){return this.p.value}set value(e){this.p.value===e||this.set("value",e)}view(){let{p:e,options:t}=this,i=d("span"),r=d("table").on("click",({currentTarget:n,target:o})=>n!=o&&(this.set("open",!1).value=d(o).closest("tr").d())),l=L("_ menu",r),u=De(this,t,i,l,n=>this.value=n).attr({name:e.name});return le(this,i),this.on(n=>"value"in n&&le(this,i)),t.bind(r,{insert:n=>Q(n.i,e.item(n)).d(n[t.key]),tag(n,o,f,y){let p=f.child(o);p.c(y,n),n&&l.e.scroll({top:p.p("offsetTop")-l.p("clientHeight")/2+p.p("clientHeight")/2})}}),u}option(e){return this.options.find(e)}}class et extends J{view(){let e=this.p,t=e.options.map(i=>Me(i)?[i]:i);return e.layout||=m(t)>3?"column":"wrap",this.bind(d("span",e.layout=="column"?"_ col":"",t.map(([i,r,l])=>d("label","cb",[d("input",{type:"radio",value:i,name:e.name,checked:i==e.value,oninput:()=>{this.set("value",i)}}),l&&S(l),r||i]))).on("click",i=>{i.altKey&&(d(i.currentTarget).queryAll("input").p("checked",!1),this.set("value",null))}),i=>{i.queryAll("input").forEach(r=>{r.checked=r.value==e.value})},"value").css("position","relative")}}class te extends J{#e;get form(){return this.#e}set form(e){this.#e=e;for(let t of this.inputs)t.form=e}constructor(e,t){e.value=null,super(e);for(let i of this.inputs=R(t))i.onset(["value","off"],()=>{let r=d(i).attr("edited",!i.isDef());this.form.p.offFN?.(r,!!i.p.off),this.set(["value"])});ye(this,e.bots)}inputs;get def(){return ne(this.inputs,e=>[e.name,e.def])}get value(){return ne(this.inputs,e=>[e.name,e.value])}set value(e){this.inputs.forEach(t=>t.name in e&&(t.value=e?e[t.name]:t.null))}view(){for(let e of this.inputs)e.onset("value",()=>this.set(["value"]));return d("span","_ join",this.inputs)}fill(e,t){if(!(this.p.sub&&!(e=e[this.p.name])))for(let i of this.inputs)i.fill(e,t)}validate(e,t,i){let r=[];for(let l of this.inputs){let u=l.invalid(l.value,t,i);u&&r.push(...u),u&&i&&(l.focus(),i=!1)}return r}focus(){return this.inputs[0]?.focus(),this}submit(e,t,i){let{inputs:r,p:l}=this;l.sub&&(e=e[l.name]=l.sub=="array"?[]:{});for(let u of t&&!l.sub?r.filter(n=>i&&n.p.req||!n.isDef()):r)u.p.off||u.submit(e,t,i)}input(e){for(let t of this.inputs)if(t.name==e||de(t,te)&&(t=t.input(e)))return t}isDef(e=this.value,t=this.def){for(let i of this.inputs)if(!i.isDef(e[i.name],t[i.name]))return!1;return!0}}class tt extends j{view(){let e=this.p,t,i=d("span"),r;if(e.setlimit)var l=new Ye({value:e.limit,fluid:!0,clear:!1},[e.min,e.min*5,e.min*10,e.min*10,e.min*20,[0,c.showAll]]);return this.bind(L("_ bar pag",[e.extreme&&I(b.first,null,()=>this.set("pag",1)),I(b.prev,null,()=>this.set("pag",e.pag-1)),d("span","hd").css({textAlign:"center"}),I(b.next,null,()=>this.set("pag",e.pag+1)),e.extreme&&I(b.last,i,()=>this.set("pag",t)),l&&[d("hr"),d(l.onset("value",({value:u})=>{this.set("limit",u)}),"i")],d("hr"),r=d("span","hd")]),u=>{r.set(`${Math.min(e.total-e.limit*(e.pag-1),e.limit||e.total)||0} / ${e.total||0}`),t=e.limit?Math.ceil((e.total||0)/e.limit):1,u.c("off",!!(t<2&&e.hideOnSingle));let n=e.extreme?0:1;u.child(2-n).set(e.pag),u.childs(0,2-n).p("disabled",e.pag==1),u.childs(3-n,5-n*2).p("disabled",e.pag==t),i.set(t)})}get pags(){let{limit:e,total:t}=this.p;return e?Math.ceil((t||0)/e):1}}function it(s,e,t=e){let i=new tt({pag:s.pag,min:s.limit,limit:s.limit,total:s.length,extreme:t,setlimit:e}).on(r=>{"pag"in r&&(s.pag=r.pag,"limit"in r||s.update()),"limit"in r&&(s.limit=r.limit)});return s.on(([r])=>i.set({total:r,limit:s.limit,pag:s.pag})),i}class st extends j{get cols(){return this.p.cols}data;form;constructor(e,t){super(e),this.data=ce(t,{g:e.single?null:["on"],key:e.key,clear:!0}),e.head||=i=>x(x(i.text,c[i.key]),Z(i.key))}ccss(e,t,i=1){let r=0;if(Oe(t)){let l=this.cols,u=t,n=0;for(t=l[t];n<i;n++)r+=l[u+n].size}else r=t.size;return e.c("i").css({width:r+"px",textAlign:t.align})}view(){let e=this.p,t=e.cols,i=e.allColumns,r=e.reqColumns,l=this.data,u,n=i&&Y(null,i.map(a=>X(t.includes(a),x(x(a.text,c[a.key]),Z(a.key)),h=>{h?(t.push(a),t.sort((g,v)=>i.indexOf(g)-i.indexOf(v))):t.remove(a)},a.key,r&&r.includes(a.key)))).on("click",a=>T(a)),o=t.bind(L("hd _ tr",O(e.corner,"sd")),{insert:(a,h,g)=>{let v=this.ccss(O(e.head(a),"i"),a).uncss("textAlign");e.resize&&L("div").addTo(v).on("mousedown",_=>{T(_);let A=t.indexOf(a)+1;if(!e.fill||A<m(t)){let se=function(re){if(a.size=a.size=Math.max(q.rem*2,re.clientX-v.rect.left),ie.css({width:a.size+"px"}),W){let be=t[A].size=Math.max(q.rem*2,Le-re.clientX);W.css({width:be+"px"})}},ie=p.childs().child(A),W=e.fill&&ie.next(),ke=W?.e?.(0),Le=ke?.rect?.right;ae().css({cursor:"col-resize",userSelect:"none"}),oe().on("mousemove",se).one("mouseup",()=>{oe().off("mousemove",se),ae().uncss("cursor","userSelect")})}}),e.sort&&v.on("click",()=>{t.tag("sort")==a?a.desc?(a.desc=!1,t.tag("sort",null)):(a.desc=!0,t.retag("sort")):(a.desc=!1,t.tag("sort",a))}),n&&v.on({mouseenter(){clearTimeout(u),v.add(n)},mouseleave(){u=setTimeout(()=>n.remove().child(".menu")?.remove(),300)}}),g.place(h+1,v)},tag(a,h,g,v,_){let A=g.child(h+1);switch(v){case"sort":A.child(".sort")?.remove(),a&&A.add(S(b[_.desc?"desc":"asc"]).c("sort")),e.sort(_.key,_.desc,a);break;default:A.c(v,a)}},remove(a,h,g){g.unplace(h+1)},clear(a){a.childs(1).remove()}}),f=a=>d(a(this),"_ ft tr"),y=e.foot&&Ne(...e.foot.map(f)),p=L("_ tb",[o,y]).on("click",a=>a.target==a.currentTarget&&w.clear(l,"on")).p("tabIndex",0).on("keydown",a=>{nt(l,a,e)&&T(a)}),k=a=>[L("sd"),t.map(h=>this.ccss(O(h.fmt?h.fmt(a[h.key],e.p,a):a[h.key]),h))];return l.bind(p,{insert:(a,h)=>{let g=L("_ tr i",k(a));p.place(h+1,lt(e.style?.(g,a,h)||g,a,l,e))},reload(a,h){p.child(h+1).set(k(a))},tag:(a,h,g)=>{let v=g.child(h+1).c("crt",a).e;a&&v.scrollIntoView({block:"nearest",inline:"nearest"})},remove(a,h,g){g.unplace(h+1)},clear(a){a.childs().slice(1).remove()},groups(a,h,g,v){g.child(h+1).c(v,a)}}),t.on(()=>{this.data.reloadAll(),y?.eachS((a,h)=>a.replace(f(e.foot[h])))}),e.resize&&p.c("brd"),p}fillArea(e=2*q.rem){let t=this.p.cols,i=d(this),r=i.childs();console.log(e,i.e.clientWidth),rt(t,i.e.clientWidth-2-e);for(let l=0;l<m(t);l++)r.child(l+1).css({width:t[l].size+"px"})}}function rt(s,e=100){let t=0,i=s.length,r=[];for(let l of s){let u=l.size||1/i;r.push(u),t+=u}for(let l=0;l<i;l++)s[l].size=r[l]/t*e}function lt(s,e,t,i){let r=l=>w.add(t,"on",e,w.tp(l.ctrlKey,l.shiftKey));return s.on({click:r,dblclick:i.open&&(()=>i.open(...w.list(t,"on"))),contextmenu:i.menu&&(l=>{r(l);let u=i.menu(w.list(t,"on"));u&&Pe(l,u)})})}const F=(s,e,{ctrlKey:t,shiftKey:i})=>i?w.move(s,"on",e,w.tp(t,!1)):t?w.movePivot(s,"on",e):w.move(s,"on",e,"set");function nt(s,e,t,i){switch(e.key){case"Delete":let r=w.list(s,"on");if(r.length&&t.remove)(async()=>{if(await t.remove(r)!==!1)for(let l of r)s.remove(l)})();else return;break;case"Home":F(s,-w.pivot(s,"on"),e);break;case"End":F(s,s.length-w.pivot(s,"on"),e);break;case"PageDown":F(s,10,e);break;case"PageUp":F(s,-10,e);break;case"Enter":if(t.open){t.open(...w.list(s,"on"));break}else return;case"ArrowUp":if(i)return;F(s,-1,e);break;case"ArrowDown":if(i)return;F(s,1,e);break;default:return}return!0}function G(s){if(s.bonds){let e=[];for(let t=0;t<s.bonds.length;t++){let i=s.bonds[t].deref();i?e[t]=i.update():s.bonds.splice(t--,1)}return e}}class at{#e;#t;#i;list;readOnly;length;task;fromStorage;toStorage;src;all;groupBy;queryBy;fields;w;constructor(e,t={}){K(t)&&(t={fields:t}),this.src=e,this.#i=x(t.limit,q.defLimit),this.#t=t.pag||1;let i=()=>{this.#t=1,this.update(!0)};this.query=t.query,this.#r=t.sort,this.#s=t.desc,this.fields=z(t.fields||R(e.fields.map(r=>C(r.get)&&r.name)),r=>{if(!M(e.fields,r,"name"))throw Ie(r,"field",e);return r}).on(()=>this.update(!0)),this.queryBy=z(t.queryBy||e.fields.filter(r=>r.query).map(r=>r.name)).on(i),this.w=t.where}#r;#s;sort(e){return B(e)?this.#r:(e!=this.#r&&(e==null&&(this.#s=void 0),this.#r=e,this.update(!0)),this)}desc(e){return B(e)?this.#s:(e!=this.#s&&(this.#s=e,this.update(!0)),this)}get pags(){return this.#i?Math.ceil(this.length/this.#i):1}get query(){return this.#e}set query(e){e!=this.#e&&(this.#t=1,this.#e=e,this.update(!0))}get pag(){return this.#t}set pag(e){e<1?e=1:e>this.pags&&(e=this.pags),this.#t!=e&&(this.#t=e,this.update())}get limit(){return this.#i}set limit(e){this.#i!=e&&(this.#t=e?Math.ceil(this.#i*this.#t/e):1,this.#i=e,this.update())}ids(){let e=this.src;if(this.pags>1){let t=this.toJSON();return e.get({tp:"col",fields:[e.id],where:t.where,query:t.query,queryBy:t.queryBy})}else return this.list.map(t=>e.id||t.id)}rmvFilter(e){let t=ge(this.w||=[],e,0);return t!=-1&&this.w.splice(t,1),this}where(e,t,i){let r=M(this.w||=[],e,0);return r?(r[1]=t,r[2]=i):this.w.push(r=[e,t,i]),r[2]||r.pop(),this.update(!0),this}bind(e){if(!this.list){let t=this.src;(this.list=K(e)?e:z(e)).key=t.id,(t.bonds||=[]).push(new WeakRef(this)),this.update()}return this.list}getAll(e="rows"){return this.src.get(D(this.toJSON(),{tp:e,limit:void 0,pag:void 0}))}#l;#n;update(e){let t=async()=>{let i={},r={},l=this.list,u=this.#a;if(l||u){let n=this.src,o=await(this.task=n.get(this.toJSON(),(this.#l=new AbortController).signal));if(this.task=this.#l=null,this.length=o[0],l){for(let f in l.tags)l.tags[f]&&(i[f]=l.tags[f].v[n.id]);for(let f in l.g)r[f]=l.g[f].keyField();l.set(o[1]);for(let f in i)l.tag(f,i[f]);for(let f in r){let y=r[f];l.g[f].set(l.filter(p=>y.indexOf(p[n.id||"id"])!=-1))}}if(u)for(let f of u)f(o);return o}};return this.#l?.abort(),clearTimeout(this.#n),this.task=null,e?(this.#n=setTimeout(t),this):t()}#a;on(e){return(this.#a||=[]).push(e),this}toJSON(){let{query:e,queryBy:t,fields:i,w:r,src:l,limit:u,pag:n}=this;return{tp:"full",fields:!m(i)||m(l.fields)==m(i)?void 0:i.map(o=>{let f=M(l.fields,o,"name").exp;return f?[o,f]:o}),where:r,limit:u,pag:n==1?void 0:n,query:e||void 0,queryBy:e&&m(t)?t:void 0,sort:this.#r,desc:this.#s}}}const ot=s=>d("label","_ in",[Se(d("input",{type:"search",name:`${s.src}_search`,value:s.query||"",placeholder:c.search+"..."}),"input",500,function(){s.query=this.value}),Be(b.search,null,()=>s.update())]);function ut({queryBy:s,src:e}){let t=e.fields.filter(r=>r.query);if(!t.length)return null;let i=Ee([X(m(t)==m(s)?!0:m(s)?null:!1,c.all,r=>s.set(r&&t.map(l=>l.name)),"all"),Re(),...t.map(r=>X(s.includes(r.name),x(r.text,Z(r.name)),l=>l?s.push(r.name):s.remove(r.name),r.name))]);return s.on(()=>{i.query("#all").p({checked:m(t)==m(s),indeterminate:m(s)&&m(t)!=m(s)});for(let r of i.queryAll("input:not(#all)"))r.checked=s.includes(r.id)}),Y(null,()=>i)}function ft(s,e){let t=s.bind(),i=d("input",{type:"checkbox"}).on("input",()=>{i.p("checked")?(w.addAll(t,"on"),i.p({checked:!0,indeterminate:!1}),s.all=void 0,E(d(e),async()=>{let r=await s.getAll();B(s.all)&&(s.all=r)},null,250)):w.clear(t,"on")});return w.onchange(t,"on",(r,l)=>{s.all=null,i.p({checked:!!r,indeterminate:!!r&&(s.pags>1||(l?l.length<t.length:t.length>1))})}),i}const dt={null:()=>L(0,S(b.null)),invalidIcon:()=>S("image-broken"),checkboxFmt:"icon",wrap:O,html:!0,interactive:!0,format:!0};function ht(s,e={}){let t=s.src,i=t.fields.filter(o=>C(o.get)),r=i.map(o=>({dt:o.dt,key:o.name,text:o.text,size:(o.size||10)*q.rem,align:o.align,fmt:o.out?.bind(o)}));m(s.fields)||s.fields.set(U(i,"name"));let l=z(s.fields.map(o=>M(r,o,"key")));Ve(l,s.fields,!1,o=>o.key);let u=d("span"),n=new st({cols:l,fill:e.fill,resize:!0,single:e.single,style:e.style||t.style,p:e.p||dt,corner:u,menu:e.menu&&(o=>e.menu(s.all||o,s,n)),open:o=>we(t,o?.id),remove:o=>xe(t,U(o,t.id||"id")),allColumns:r,reqColumns:e.req||[t.main],key:t.id||"id",sort(o,f,y){s.sort(y?o:null).desc(f)},clearSort:!0},s.bind());return u.add(ft(s,d(n))),n}async function mt(s,e){return s.mdform?s.mdform():(e||=s.form?await s.form(s):new ee(s.fields.map(t=>t.set&&t.in())),Ge([0,$(c.newItemTitle,{src:s.s})],e,t=>s.post([t])))}async function we(s,e,t){let i=await s.get({tp:"row",where:[[s.id,e]],src:!0});if(s.mdform)return s.mdform(i);he([0,$(c.editItemTitle,{src:s.s,item:d("strong",0,i[s.main])})],(t||=s.form?await s.form(s,!0):new ee(s.fields.map(r=>x(r.edit,r.set)&&r.in()))).set("tag","div").fill(i,!0),(r,l)=>[ue(c.save,async u=>{T(u),t.valid()&&await E(l,()=>s.put([D(t.data(!0),{id:e})])),r()},"submit").c("accept"),s.post&&ue(c.duplicate,async u=>{T(u),t.valid()&&await E(l,()=>s.post([t.data()])),r()},"submit"),me(r)]),t.focus()}function $(s,e){if(s){let t=[],i=/{(\w+)}/g,r,l=0;for(;r=i.exec(s);)t.push(s.slice(l,l=r.index),e[r[1]]),l+=m(r[0]);return t.push(s.slice(l,m(s))),R(t)}}async function xe(s,e){let t=m(e),i=e[0]?.[s.main];await ze(t==1&&i?$(c.confirmRemove,{src:s.s,item:d("strong",0,i)}):$(c.confirmRemoveMany,{src:t==1?s.s:s.p,count:t}))&&await s.del(e.map(r=>pe(r)?r[s.id]:r))}function ct(s,e){return Q(b.remove,c.remove,()=>xe(s,e),q.sc?.remove,!m(e)||!s.del)}function pt(s,e){return Q(b.edit,c.edit,()=>we(s,e[0][s.id]),q.sc?.edit,m(e)!=1||!s.put)}function gt(s,{src:e}){return[pt(e,s),ct(e,s)]}async function vt(s,e={}){let t=s.src,i=ht(s,{menu:_e(e.menu)?e.menu:gt,single:e.single});return[L("_ bar",[ot(s),ut(s),He(),await e.options?.(s,i),C(e.add)&&t.post&&I(b.plus,`${c.add} ${t.s||""}`,()=>mt(t)).id("add"),e.more&&Y(null,e.more,"vs")]),d(i).css("flex",1),d(it(s,!0),0,[d("hr","r"),e.totals&&(()=>{let r=L("_ bar",e.totals);return s.on(()=>r.set(e.totals)),r})()])]}const H=(s,{req:e,def:t,text:i,query:r,input:l,set:u}={})=>({name:s,set:C(u),text:i,in:()=>new Qe({name:s,input:l,req:e,def:t,text:i}),query:C(r)}),yt=(s,e,{req:t,def:i,text:r,set:l,query:u}={})=>({name:s,set:C(l),text:r,in:()=>new et({name:s,req:t,def:i,text:r,options:e}),query:C(u),out:(n,o)=>n==null?o.null:M(e,n,0)[1]});function wt(s,e,t={}){let i=t.id||="id",r=x(t.autoIncrement,i=="id");if(r)var l=(U(s,i).reduce((n,o)=>n>o?n:o)||1)+1;let u={id:i,fields:e,s:t.s,p:t.p,src:s,main:t.main||e[0].name,get(n){return new Promise(o=>{let f=s;if(n.query){let p=n.queryBy||e.filter(k=>k.query).map(k=>k.name);if(m(p)){let k=R(n.query.split(" ")).map(a=>a.toLocaleUpperCase());f=f.filter(a=>{for(let h of k){let g;for(let v of p)if(g=(a[v]+"").toLocaleUpperCase().includes(h))break;if(!g)return!1}return!0})}}if(n.where?.length&&(f=f.filter(p=>{for(let[k,a]of n.where)if(p[k]!=a)return!1;return!0})),n.sort){f===s&&(f=f.slice());let p=n.sort,k=n.desc?1:-1;f.sort((a,h)=>{let g=a[p],v=h[p];return g==v?0:(v==null?-1:g==null||v>g?1:-1)*k})}let y=m(f);if(n.limit){let p=n.pag||1;f=f.slice((p-1)*n.limit,p*n.limit)}switch(n.tp||"rows"){case"full":o([y,f]);break;case"rows":o(f);break;case"col":o(U(f,n.fields[0]));break;case"row":o(f[0]);break;case"one":o(x(f[0]?.[n.fields[0]],null));break;default:throw"not supported"}})},post(n){let o=Array(m(n));for(let f of n){if(f[i]==null)if(r)f[i]=l++;else throw"invalid";if(M(s,f[i],i))throw"invalid";o.push({[i]:f[i]}),s.push(f)}return G(u),o},put(n){for(let o of n){let f=M(s,o.id,i);if(f)for(let y in o)f[y]=o[y];else console.warn(`item of id '${o.id}' not found`)}G(u)},del(n){for(let o of n){let f=ge(s,o,i);f!=-1&&s.splice(f,1)}G(u)}};return u}function xt(){D(c,{cancel:"Cancel",confirm:"Confirm",required:"Required",search:"Search",add:"Add",confirmRemove:"{src} {item} willbe removed, deseja continuar?",confirmRemoveMany:"Será removido {count} {src}, deseja continuar?",duplicate:"Duplicate",edit:"Edit",editItemTitle:"Modify {src} {item}",false:"False",newItemTitle:"Register {src}",remove:"Remove",save:"Save",showAll:"Show all",true:"True"})}function kt(){D(c,{cancel:"Cancelar",confirm:"Confirmar",required:"Obrigatorio",search:"Pesquisar",add:"Adicionar",confirmRemove:"{src} {item} Será removido, deseja continuar?",confirmRemoveMany:"Será removido {count} {src}, deseja continuar?",duplicate:"Duplicar",edit:"Editar",editItemTitle:"Modificar {src} {item}",false:"Falso",newItemTitle:"Cadastrar {src}",remove:"Remover",save:"Salvar",showAll:"Mostrar todos",true:"Verdade"})}function Lt(){D(b,{close:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",plus:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",prev:"M14,7L9,12L14,17V7Z",next:"M10,17L15,12L10,7V17Z",first:"M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z",last:"M16,18H18V6H16M6,18L14.5,12L6,6V18Z",dd:"M7,10L12,15L17,10H7Z",search:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z",edit:"M18.62,1.5C18.11,1.5 17.6,1.69 17.21,2.09L10.75,8.55L14.95,12.74L21.41,6.29C22.2,5.5 22.2,4.24 21.41,3.46L20.04,2.09C19.65,1.69 19.14,1.5 18.62,1.5M9.8,9.5L3.23,16.07L3.93,16.77C3.4,17.24 2.89,17.78 2.38,18.29C1.6,19.08 1.6,20.34 2.38,21.12C3.16,21.9 4.42,21.9 5.21,21.12C5.72,20.63 6.25,20.08 6.73,19.58L7.43,20.27L14,13.7",remove:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",asc:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z",desc:"M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"})}Ze({pt:{hi:"Ola, meu nome é",fname:"Primeiro Nome",lname:"Ultimo Nome",addr:"Endereço",gender:"Género",genderF:"Femenino",genderM:"Masculino",crudTitle:"CRUD simples com suporte para inserção, modificição e remosão de dados"},en:{hi:"Hi, my name is",fname:"First Name",lname:"Last Name",addr:"Address",add:"Add",crudTitle:"Simple crud with suport to add, edit and remove.",gender:"Gender",genderF:"Female",genderM:"Male"}});Ke=="pt"?kt():xt();Lt();const bt=wt(Ue,[H("fname",{req:!0,text:c.fname}),H("lname",{req:!0,text:c.lname}),H("email",{input:"email"}),H("tel",{input:"tel"}),yt("gender",[["F",c.genderF],["M",c.genderM]],{text:c.gender}),H("addr",{text:c.addr})],{s:N("Customer","Cliente")}),V=(s,e)=>d("a","_ link",e).p("href",s);$e("cruded",[d("h2",[c.crudTitle]),E(()=>vt(new at(bt,{limit:10}))),d("h3",{id:"install"},N("Instalation","Instalação")),d("p",0,"npm i cruded"),d("h3",{id:"funcs"},N("Functionalities","Funcionalidades")),fe("generate list for pagination","search input","contextmenu per item","diferent field types",["support diferent data source",fe([V("#fromArray","fromArray")," get data from simple array"],[V("#fromIDB","fromIDB")," get data from IndexedDB (todo)"],[V("#fromFetch","fromFetch")," get data from url `REST API` using fetch API"],[V("#fromMethods","fromMethods")," get data from custom methods"])],"generate form for insert and update data"),d("h3",{id:"sample"},N("Sample","Exemplo")),je(`
import { crud, fromArray, fText,fRadio } from "cruded";
import { get } from "galho";

const list = [
  { id: 1, fname: "Bobette", lname: "Oldroyde",  gender: "F", tel: "508-974-4484", addr: "Room 1396"  },
  { id: 2, fname: "Quincey", lname: "Livermore", gender: "M", tel: null,           addr: null         },
  { id: 3, fname: "Billye",  lname: "Boutcher",  gender: "F", tel: "472-985-4634", addr: "7th Floor"  },
  { id: 4, fname: "Ardine",  lname: "Bontine",   gender: "F", tel: "620-502-4286", addr: "Suite 63"   },
  { id: 5, fname: "Clayton", lname: "Dunkley",   gender: "M", tel: "698-922-1909", addr: "16th Floor" },
];

//create datasource from array
const src = fromArray(list, [
  fText("fname", { req: true, text: w.fname }),
  fText("lname", { req: true, text: w.lname }),
  fText("tel", { input: "tel" }),
  fRadio("gender", [["F", w.genderF], ["M", w.genderM]], { text: w.gender }),
  fText("addr", { text: w.addr }),
]);

//create bond to datasource, limit:10 define number of item per pag
const bond=new Bond(src, { limit: 10 });

//render crud component, limit
const myCrud = crud(bond);

//add crud to document.body
get("body").add(myCrud);`)]);
